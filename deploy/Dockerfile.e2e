# Dockerfile for E2E Test Runner
# Runs integration tests against the server

FROM golang:1.22-alpine

WORKDIR /app

# Install dependencies
RUN apk add --no-cache gcc musl-dev

# Copy go mod files
COPY go.mod go.sum ./
RUN go mod download

# Copy source (needed for tests)
COPY . .

# Pre-build test binary to speed up test runs
RUN go test -c -tags=e2e -o /e2e-tests ./test/e2e/... 2>/dev/null || true

ENTRYPOINT ["go", "test"]
CMD ["-v", "-tags=e2e", "./test/e2e/..."]
